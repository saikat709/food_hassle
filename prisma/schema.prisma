// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id                  String        @id @default(cuid())
  email               String        @unique
  password            String
  fullName            String
  householdSize       Int           @default(1)
  dietaryPreferences  String[]      @default([])
  budgetRange         String        @default("Medium")
  location            String?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  
  chatSessions        ChatSession[]
  mealPlans           MealPlan[]
  inventoryItems      InventoryItem[]
  consumptions        Consumption[]

  @@map("users")
}

model InventoryItem {
  id            String    @id @default(cuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name          String
  quantity      Float
  unit          String
  category      String
  purchaseDate  DateTime?
  expiryDate    DateTime?
  costPerUnit   Float?
  imageUrl      String?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("inventory_items")
  @@index([userId])
  @@index([expiryDate])
}

model ChatSession {
  id          String        @id @default(cuid())
  userId      String
  title       String        @default("New Conversation")
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages    ChatMessage[]

  @@map("chat_sessions")
  @@index([userId])
}

model ChatMessage {
  id          String      @id @default(cuid())
  sessionId   String
  role        String      // 'user' or 'assistant'
  content     String      @db.Text
  metadata    Json?       // For storing additional context
  createdAt   DateTime    @default(now())
  
  session     ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("chat_messages")
  @@index([sessionId])
}

model MealPlan {
  id              String         @id @default(cuid())
  userId          String
  weekStartDate   DateTime
  totalBudget     Float
  estimatedCost   Float
  nutritionGoals  Json?          // Store nutrition requirements
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  items           MealPlanItem[]

  @@map("meal_plans")
  @@index([userId])
}

model MealPlanItem {
  id              String    @id @default(cuid())
  mealPlanId      String
  dayOfWeek       Int       // 0-6 (Sunday-Saturday)
  mealType        String    // 'breakfast', 'lunch', 'dinner', 'snack'
  recipeName      String
  ingredients     Json      // Array of ingredients with quantities
  estimatedCost   Float
  nutritionInfo   Json?     // Calories, protein, carbs, etc.
  instructions    String?   @db.Text
  
  mealPlan        MealPlan  @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)

  @@map("meal_plan_items")
  @@index([mealPlanId])
}

model Consumption {
  id                  String    @id @default(cuid())
  userId              String
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  itemName            String
  quantity            Float
  unit                String
  category            String?
  consumptionDate     DateTime
  consumptionTime     String?   // HH:MM format
  notes               String?   @db.Text
  removedFromInventory Boolean  @default(false)
  
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  
  @@map("consumptions")
  @@index([userId])
  @@index([consumptionDate])
}
